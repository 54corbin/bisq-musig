<mxfile host="drawio-plugin" modified="2025-01-24T13:13:04.708Z" agent="Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36" etag="LmaC6CUMCY_aVq8twD3X" version="22.1.22" type="embed">
  <diagram name="Page-1" id="4t2JOigZqfDRrmz9JXpL">
    <mxGraphModel dx="1362" dy="773" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="0" pageScale="1" pageWidth="827" pageHeight="1169" background="#FFFFFF" math="1" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="2" value="Alice&#39;s Funds" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="-40" y="233" width="140" height="150" as="geometry" />
        </mxCell>
        <mxCell id="75" value="&lt;b&gt;Output 0: &lt;/b&gt;UTXO to accelerate WarningTx" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;" vertex="1" parent="2">
          <mxGeometry y="30" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="3" value="&lt;b&gt;Output 1: &lt;/b&gt;Seller deposit and trade amount&amp;nbsp;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;" parent="2" vertex="1">
          <mxGeometry y="90" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="6" value="Bob&#39;s Funds" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;fillColor=#ffe6cc;strokeColor=#d79b00;" parent="1" vertex="1">
          <mxGeometry x="-30" y="620" width="145" height="70" as="geometry" />
        </mxCell>
        <mxCell id="7" value="&lt;b&gt;Output 0: &lt;/b&gt;Buyer deposit&amp;nbsp;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;" parent="6" vertex="1">
          <mxGeometry y="30" width="145" height="40" as="geometry" />
        </mxCell>
        <mxCell id="12" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;labelBackgroundColor=none;fontColor=default;exitX=0.5;exitY=0;exitDx=0;exitDy=0;" parent="1" source="8" target="3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="22" value="Alice Signature" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];labelBackgroundColor=none;" parent="12" vertex="1" connectable="0">
          <mxGeometry x="0.2175" y="-1" relative="1" as="geometry">
            <mxPoint x="24" y="-12" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="8" value="Deposit Tx" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;fillColor=#d5e8d4;strokeColor=#82b366;gradientColor=#97d077;" parent="1" vertex="1">
          <mxGeometry x="100" y="420" width="220" height="150" as="geometry" />
        </mxCell>
        <mxCell id="10" value="&lt;b&gt;Output&lt;/b&gt;&amp;nbsp;0: Seller deposit and trade amount&lt;br&gt;Taproot key spend: P&#39;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;" parent="8" vertex="1">
          <mxGeometry y="30" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="14" value="&lt;b&gt;Output&lt;/b&gt;&amp;nbsp;1: Buyer deposit&lt;br&gt;Taproot key spent: Q&#39;" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;" parent="8" vertex="1">
          <mxGeometry y="90" width="220" height="60" as="geometry" />
        </mxCell>
        <mxCell id="15" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1.005;entryY=0.342;entryDx=0;entryDy=0;entryPerimeter=0;exitX=0.453;exitY=0.99;exitDx=0;exitDy=0;exitPerimeter=0;labelBackgroundColor=none;fontColor=default;" parent="1" source="14" target="7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="23" value="Bob&#39;s Signature" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];labelBackgroundColor=none;" parent="15" vertex="1" connectable="0">
          <mxGeometry x="0.2283" y="1" relative="1" as="geometry">
            <mxPoint y="-14" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="16" value="Warning Tx Alice / Bob" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;fillColor=#b0e3e6;strokeColor=#0e8088;" parent="1" vertex="1">
          <mxGeometry x="410" y="250" width="260" height="270" as="geometry" />
        </mxCell>
        <mxCell id="17" value="&lt;b style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;Output 0&lt;/font&gt;&lt;span style=&quot;font-size: 13px;&quot;&gt;: &lt;/span&gt;&lt;/b&gt;buyer deposit&amp;nbsp;seller deposit and trade amount&lt;br&gt;&lt;b&gt;key spend&lt;/b&gt;: S&#39; / R&#39;&amp;nbsp;(Bob / Alice can claim if key exchange already happened)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;opacity=0;" parent="16" vertex="1">
          <mxGeometry y="30" width="260" height="80" as="geometry" />
        </mxCell>
        <mxCell id="63" value="&lt;b style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;Output 1&lt;/font&gt;&lt;span style=&quot;font-size: 13px;&quot;&gt;: &lt;/span&gt;&lt;/b&gt;buyer deposit&amp;nbsp;seller deposit and trade amount&lt;br&gt;&lt;b&gt;key spend&lt;/b&gt;: S&#39; / R&#39;&amp;nbsp;(Bob / Alice can claim if key exchange already happened)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;opacity=0;" vertex="1" parent="16">
          <mxGeometry y="110" width="260" height="80" as="geometry" />
        </mxCell>
        <mxCell id="68" value="&lt;b style=&quot;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;Output 2&lt;/font&gt;&lt;span style=&quot;font-size: 13px;&quot;&gt;: &lt;/span&gt;&lt;/b&gt;change amount&lt;br&gt;&lt;b&gt;key spend&lt;/b&gt;: S&#39; / R&#39;&amp;nbsp;(Bob / Alice can claim if key exchange already happened)" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;opacity=0;" vertex="1" parent="16">
          <mxGeometry y="190" width="260" height="80" as="geometry" />
        </mxCell>
        <mxCell id="20" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;labelBackgroundColor=none;fontColor=default;exitX=0;exitY=0.4;exitDx=0;exitDy=0;exitPerimeter=0;" parent="1" source="17" target="10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="21" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;labelBackgroundColor=none;fontColor=default;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="63" target="14" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="440" y="561.4634146341464" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="33" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;labelBackgroundColor=none;fontColor=default;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fillColor=#1ba1e2;strokeColor=#006EAF;" parent="1" source="44" target="17" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="680" y="435" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="47" value="nSequence t&lt;sub&gt;1&lt;/sub&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];labelBackgroundColor=none;" parent="33" vertex="1" connectable="0">
          <mxGeometry x="-0.0842" y="3" relative="1" as="geometry">
            <mxPoint x="31" y="10" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="34" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;labelBackgroundColor=none;fontColor=default;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fillColor=#1ba1e2;strokeColor=#006EAF;" parent="1" source="51" target="17" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="780" y="580" as="sourcePoint" />
            <mxPoint x="700" y="530" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="46" value="nSequence t&lt;font size=&quot;1&quot;&gt;&lt;sub&gt;2&lt;/sub&gt;, t&lt;sub&gt;2&lt;/sub&gt; &amp;gt; t&lt;sub&gt;1&lt;/sub&gt;&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];labelBackgroundColor=none;" parent="34" vertex="1" connectable="0">
          <mxGeometry x="0.1101" y="2" relative="1" as="geometry">
            <mxPoint x="54" y="-7" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="40" value="SwapTx" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;fillColor=#d0cee2;strokeColor=#56517e;" parent="1" vertex="1">
          <mxGeometry x="440" y="580" width="140" height="90" as="geometry" />
        </mxCell>
        <mxCell id="41" value="&lt;b&gt;Output 0:&lt;/b&gt;&lt;br&gt;key spend to Alice&#39;s Wallet" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;" parent="40" vertex="1">
          <mxGeometry y="30" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="42" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;exitX=0;exitY=0.25;exitDx=0;exitDy=0;labelBackgroundColor=none;fontColor=default;" parent="1" source="40" target="14" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="53" value="adaptor Signature &lt;br&gt;reveals pA only to Bob" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" parent="42" vertex="1" connectable="0">
          <mxGeometry x="0.0049" y="3" relative="1" as="geometry">
            <mxPoint x="-28" y="21" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="43" value="&lt;font style=&quot;&quot;&gt;&lt;span style=&quot;font-size: 20px;&quot;&gt;Alice: Seller&lt;/span&gt;&lt;br&gt;&lt;span style=&quot;font-size: 20px;&quot;&gt;Bob: Buyer&lt;/span&gt;&lt;br&gt;&lt;font style=&quot;font-size: 11px;&quot;&gt;change output and funding from multiple inputs not shown anymore&lt;/font&gt;&lt;br&gt;&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fillColor=none;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="-50" y="153" width="350" height="80" as="geometry" />
        </mxCell>
        <mxCell id="44" value="Redirect Tx&lt;br&gt;Bob / Alice" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;fillColor=#b0e3e6;strokeColor=#0e8088;" parent="1" vertex="1">
          <mxGeometry x="810" y="270" width="180" height="130" as="geometry" />
        </mxCell>
        <mxCell id="45" value="multiple key spend outputs to the burning men." style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;" parent="44" vertex="1">
          <mxGeometry y="30" width="180" height="50" as="geometry" />
        </mxCell>
        <mxCell id="62" value="&lt;b&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;Output n + 1:&lt;/font&gt;&lt;/b&gt; anchor output&lt;br&gt;&lt;b&gt;key spend:&lt;/b&gt; Pubkey of Bob / Alice" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;labelBackgroundColor=none;" parent="44" vertex="1">
          <mxGeometry y="80" width="180" height="50" as="geometry" />
        </mxCell>
        <mxCell id="51" value="Claim Tx Alice / Bob" style="swimlane;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=30;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=1;marginBottom=0;whiteSpace=wrap;html=1;fillColor=#d0cee2;strokeColor=#56517e;" parent="1" vertex="1">
          <mxGeometry x="800" y="560" width="140" height="60" as="geometry" />
        </mxCell>
        <mxCell id="52" value="Output 0: to Alice / Bob wallet" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;spacingLeft=4;spacingRight=4;overflow=hidden;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;rotatable=0;whiteSpace=wrap;html=1;" parent="51" vertex="1">
          <mxGeometry y="30" width="140" height="30" as="geometry" />
        </mxCell>
        <mxCell id="60" value="&lt;h1&gt;Transactions&amp;nbsp;&lt;/h1&gt;&lt;p&gt;&lt;span style=&quot;background-color: rgb(255, 230, 204);&quot;&gt;These transaction preexist, they are the funds Alice and Bob have for beginning the trade. All other transactions get constructed when the trade starts.&lt;/span&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;background-color: rgb(213, 232, 212);&quot;&gt;Only the DepositTx is broadcasted at the time of creation, the transactions right of it will the problem that the necessary fee rate is not known for the time they are broadcasted.&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;background-color: rgb(208, 206, 226);&quot;&gt;These transaction have outputs which are spendable by their owners, to bump up the fees the owner can CPFP them.&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;span style=&quot;background-color: rgb(176, 227, 230);&quot;&gt;These transactions need an anchor output, so that the time they are mined can be speed up. This is especially important for RedirectTX since it must be mined before t&lt;sub&gt;2&lt;/sub&gt;&lt;span style=&quot;font-size: 10px;&quot;&gt;&amp;nbsp;.&lt;/span&gt;&lt;/span&gt;&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" parent="1" vertex="1">
          <mxGeometry x="-10" y="740" width="430" height="260" as="geometry" />
        </mxCell>
        <mxCell id="64" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;labelBackgroundColor=none;fontColor=default;entryX=0.996;entryY=0.175;entryDx=0;entryDy=0;entryPerimeter=0;fillColor=#1ba1e2;strokeColor=#006EAF;" edge="1" parent="1" source="44" target="63">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="680" y="380" as="targetPoint" />
            <mxPoint x="830" y="371" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="65" value="nSequence t&lt;sub&gt;1&lt;/sub&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];labelBackgroundColor=none;" vertex="1" connectable="0" parent="64">
          <mxGeometry x="-0.0842" y="3" relative="1" as="geometry">
            <mxPoint x="31" y="10" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="66" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;labelBackgroundColor=none;fontColor=default;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fillColor=#1ba1e2;strokeColor=#006EAF;" edge="1" parent="1" source="51" target="63">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="792" y="570" as="sourcePoint" />
            <mxPoint x="680" y="380" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="67" value="nSequence t&lt;font size=&quot;1&quot;&gt;&lt;sub&gt;2&lt;/sub&gt;, t&lt;sub&gt;2&lt;/sub&gt; &amp;gt; t&lt;sub&gt;1&lt;/sub&gt;&lt;/font&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];labelBackgroundColor=none;" vertex="1" connectable="0" parent="66">
          <mxGeometry x="0.1101" y="2" relative="1" as="geometry">
            <mxPoint x="54" y="-7" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="71" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="70">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="380" y="370" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="78" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="70">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="390" y="430" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="70" value="Signature has SIGHASH&lt;br&gt;SIGHASH_ANYONECANPAY || SIGHASH_SINGLE" style="ellipse;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="180" y="240" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="73" value="&lt;h1&gt;Signature SIGHASH 0x83&lt;/h1&gt;&lt;p&gt;Here I tried to figured out if we can make use of different sighashes to get rig of the anchor output, for the WarningTx it could work with&amp;nbsp;SIGHASH_ANYONECANPAY || SIGHASH_SINGLE. it does sign one input and one output. Therefore from previous version we need to dublicate Output 0 into 2 Output artificially, because from The DepositTx we have 2 inputs.&lt;/p&gt;&lt;p&gt;Doesnt work in this context, because the RedirectTx input must have the TxId for the outpoint. The TxId of WarningTx must include all inputs and outputs at the time of creation. Further more the signatures could be used&amp;nbsp;&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="305" y="10" width="470" height="200" as="geometry" />
        </mxCell>
        <mxCell id="76" style="rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;" edge="1" parent="1" source="68" target="75">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
